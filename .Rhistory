compare_fc |>
accuracy(cv_valid) |>
rename(.model = Model) |>
filter(.id != 6) |>
group_by(Model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
gt() |>
fmt_number(decimal = 4)
compare_fc
compare_fc |>
accuracy(cv_valid) |>
rename(Model = .model) |>
filter(.id != 6) |>
group_by(Model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
gt() |>
fmt_number(decimal = 4)
cv_data <- converted_df |>
stretch_tsibble(.init = 1506, .step = 60)
cv_trn <- cv_data |>
group_by(.id) |>
slice(1:(n() - 60)) |>
ungroup()
cv_valid <- cv_data |>
group_by(.id) |>
slice_tail(n = 60) |>
ungroup()
compare_fc |>
accuracy(cv_valid) |>
rename(Model = .model) |>
filter(.id != 6) |>
group_by(Model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
gt() |>
fmt_number(decimal = 4)
#| warning: false
compare_fit <- cv_trn |>
model(
ETS = ETS(actual_temp ~ error("A") + trend("A") + season("A")),
TSLM = TSLM(log(actual_temp) ~ trend() + season()),
ARIMA = ARIMA(actual_temp ~ 0 + pdq(3, 1, 2) + PDQ(1, 1, 2))
)
compare_fc <- compare_fit |>
forecast(new_data = cv_valid)
compare_fc |>
accuracy(cv_valid) |>
filter(.id != 6) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
compare_fc |>
filter(.id %in% c(10, 11)) |>
autoplot() +
autolayer(converted_df |> filter(year(Date) > 2010), actual_temp) +
facet_wrap(~ .model, ncol = 1) +
theme_minimal()
compare_fc |>
accuracy(cv_valid) |>
rename(Model = .model) |>
filter(.id != 6) |>
group_by(Model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
gt() |>
fmt_number(decimal = 4) |>
cols_align(
align = "center",
columns = everything()
)
compare_cap <- "Comparing ETS(A, A, A) in green, TSLM(trend + season) with log transformation in blue and ARIMA(3, 1, 2)(1, 1, 2) with log transformation in red"
compare_fc |>
filter(.id %in% c(10, 11)) |>
autoplot() +
autolayer(converted_df |> filter(year(Date) > 2015), actual_temp) +
labs(title = "Comparison of best non-predictor models", y = 'Temperature', caption = str_wrap(compare_cap, width = 80)) +
facet_wrap(~ .model, ncol = 1) +
theme_minimal() +
theme(plot.caption = element_text(hjust = 0.5))
compare_fc |>
filter(.id %in% c(10, 11)) |>
autoplot() +
autolayer(converted_df |> filter(year(Date) > 2015), actual_temp) +
labs(title = "Comparison of best non-predictor models", y = 'Temperature', x = "", caption = str_wrap(compare_cap, width = 80)) +
facet_wrap(~ .model, ncol = 1) +
theme_minimal() +
theme(plot.caption = element_text(hjust = 0.5))
compare_fc |>
filter(.id %in% c(10, 11)) |>
autoplot() +
autolayer(converted_df |> filter(year(Date) > 2015), actual_temp) +
labs(title = "Comparison of best non-predictor models",
y = 'Temperature', x = "",
caption = str_wrap(compare_cap, width = 80),
colour = "Model",
fill = "Model") +
facet_wrap(~ .model, ncol = 1) +
theme_minimal() +
theme(plot.caption = element_text(hjust = 0.5))
final_fc |>
filter(.id %in% c(4, 5), .model %in% c("tslm_no_trend", "arima_auto_10", "ets_additive")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_wrap(~ .model, ncol = 1) +
theme_minimal()
final_fc
final_fc |>
filter(.id %in% c(4, 5), .model %in% c("tslm_no_trend", "arima_auto_10", "ets_additive")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_grid(.model ~ .id) +
theme_minimal()
final_fc |>
filter(.id == 5, .model %in% c("tslm_no_trend", "arima_auto_10", "ets_additive")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_wrap(~ .model, ncol = 1) +
theme_minimal()
final_fc |>
filter(.id == 5, .model %in% c("tslm_no_trend", "arima_auto_10", "ets_additive")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2018), actual_temp) +
facet_wrap(~ .model, ncol = 1) +
theme_minimal()
labels <- c(
"ets_additive" = "ETS Additive",
"tslm_no_trend" = "TSLM No Trend",
"arima_physics_robust_decay_enso_3" = "Arima w/ Volcanic Decay"
)
final_fit |>
select(arima_physics_robust_decay_enso_3) |>
tail(n = 1) |>
report()
caption <- "Comparison of ARIMA(2, 0, 2)(0, 1, 2) with rf_co2, enso_smooth_3 and volcano_forcing in red, ETS(A, A, A) in green and TSLM(season + enso_smooth_12 + co2_lag10) with a box-cox transformation in blue.  Forecast is from last cross validation split, actual time series shown in black, extending from 2018 to most recent observation"
final_fc |>
filter(.id == 5, .model %in% c("tslm_no_trend", "arima_physics_robust_decay_enso_3", "ets_additive")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2018), actual_temp) +
labs(title = "Final Comparison of top model",
y = 'Temperature', x = "",
caption = str_wrap(caption, width = 80),
colour = "Model",
fill = "Model") +
scale_colour_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
scale_fill_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
facet_wrap(~ .model, ncol = 1, labeller = labeller(.model = labels)) +
theme_minimal() +
theme(plot.caption = element_text(hjust = 0.5))
final_fc |>
filter(.id == 5, .model %in% c("tslm_no_trend", "arima_physics_robust_decay_enso_3", "ets_additive")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2018), actual_temp) +
labs(title = "Final Comparison of top models",
y = 'Temperature', x = "",
caption = str_wrap(caption, width = 80),
colour = "Model",
fill = "Model") +
scale_colour_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
scale_fill_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
facet_wrap(~ .model, ncol = 1, labeller = labeller(.model = labels)) +
theme_minimal() +
theme(plot.caption = element_text(hjust = 0.5))
baseline_forecast <- scenario_forecasting(0, 50, 1)
growth_forecast <- scenario_forecasting(1, 50, 1)
degrowth_forecast <- scenario_forecasting(-1, 50, 1)
# --- Baseline Forecast Trend ---
baseline_trend <- baseline_forecast |>
as_tibble() |>
select(Date, .mean) |>
# Assuming Date is a monthly date for simplicity, adjust index if needed
as_tsibble(index = Date) |>
model(STL(.mean ~ trend())) |> # Explicitly model trend for clarity
components() |>
# Select the Date and trend component
select(Date, trend) |>
mutate(Scenario = "Baseline") # Add a label
# --- Growth Forecast Trend ---
growth_trend <- growth_forecast |>
as_tibble() |>
select(Date, .mean) |>
as_tsibble(index = Date) |>
model(STL(.mean ~ trend())) |>
components() |>
select(Date, trend) |>
mutate(Scenario = "Growth") # Add a label
# --- Growth Forecast Trend ---
degrowth_trend <- degrowth_forecast |>
as_tibble() |>
select(Date, .mean) |>
as_tsibble(index = Date) |>
model(STL(.mean ~ trend())) |>
components() |>
select(Date, trend) |>
mutate(Scenario = "None") # Add a label
baseline_trend |>
autoplot(color = 'darkred') +
autolayer(growth_trend, color = 'darkblue') +
autolayer(degrowth_trend, color = 'darkgreen') +
labs(title = "Comparing Forecasts", y = "Global Temperature",
subtitle = "50 yr forecast assuming normal El Nino conditions",
caption = "Seasonality removed to visualize trend",
x = "Date") +
geom_text(
data = baseline_trend |> filter(Date == max(Date)),
aes(x = Date, y = trend, label = "Baseline"),
hjust = 0.3,
vjust = 1.5,
show.legend = FALSE
) +
geom_text(
data = growth_trend |> filter(Date == max(Date)),
aes(x = Date, y = trend, label = "1% Annual\nGrowth"),
hjust = 0.3,
vjust = 1.5,
show.legend = FALSE
) +
geom_text(
data = degrowth_trend |> filter(Date == max(Date)),
aes(x = Date, y = trend, label = "1% Annual\nReduction"),
hjust = 0.3,
vjust = 1.5,
show.legend = FALSE
) +
expand_limits(x = max(baseline_trend$Date) + 8) +
theme_minimal()
caption <- "STL Decomposition was performed to remove seasonality and focus on trend"
baseline_trend |>
autoplot(color = 'darkred') +
autolayer(growth_trend, color = 'darkblue') +
autolayer(degrowth_trend, color = 'darkgreen') +
labs(title = "Comparing Forecasts", y = "Global Temperature",
subtitle = "50 yr forecast assuming normal El Nino conditions",
caption = caption,
x = "") +
geom_text(
data = baseline_trend |> filter(Date == max(Date)),
aes(x = Date, y = trend, label = "Baseline"),
hjust = 0.3,
vjust = 1.5,
show.legend = FALSE
) +
geom_text(
data = growth_trend |> filter(Date == max(Date)),
aes(x = Date, y = trend, label = "1% Annual\nGrowth"),
hjust = 0.3,
vjust = 1.5,
show.legend = FALSE
) +
geom_text(
data = degrowth_trend |> filter(Date == max(Date)),
aes(x = Date, y = trend, label = "1% Annual\nReduction"),
hjust = 0.3,
vjust = 1.5,
show.legend = FALSE
) +
expand_limits(x = max(baseline_trend$Date) + 8) +
theme_minimal() +
theme(plot.caption = element_text(h_just = 0.5))
baseline_trend |>
autoplot(color = 'darkred') +
autolayer(growth_trend, color = 'darkblue') +
autolayer(degrowth_trend, color = 'darkgreen') +
labs(title = "Comparing Forecasts", y = "Global Temperature",
subtitle = "50 yr forecast assuming normal El Nino conditions",
caption = caption,
x = "") +
geom_text(
data = baseline_trend |> filter(Date == max(Date)),
aes(x = Date, y = trend, label = "Baseline"),
hjust = 0.3,
vjust = 1.5,
show.legend = FALSE
) +
geom_text(
data = growth_trend |> filter(Date == max(Date)),
aes(x = Date, y = trend, label = "1% Annual\nGrowth"),
hjust = 0.3,
vjust = 1.5,
show.legend = FALSE
) +
geom_text(
data = degrowth_trend |> filter(Date == max(Date)),
aes(x = Date, y = trend, label = "1% Annual\nReduction"),
hjust = 0.3,
vjust = 1.5,
show.legend = FALSE
) +
expand_limits(x = max(baseline_trend$Date) + 8) +
theme_minimal() +
theme(plot.caption = element_text(hjust = 0.5))
ets_fit |>
glance()
ets_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AICc)) |>
arrange(AICc)
ets_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AICc, .fns = mean)) |>
arrange(AICc)
ets_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AIC, .fns = mean)) |>
arrange(AICc)
ets_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AIC, .fns = mean)) |>
arrange(AIC)
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_grid(.model ~ .id) +
theme_minimal()
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_grid(.model ~ .id) +
theme_minimal()
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_grid(.model ~ .id) +
theme_minimal()
tslm_fc
tail(tslm_fc)
tslm_second_fc
tslm_best_fc
tslm_fc |>
bind_rows(tslm_second_fc) |>
bind_rows(tslm_best_fc) |>
filter(.id == 5, .model %in% c("tslm_no_trend", "tslm_enso_smooth_lag", "tslm_nino_50_lag", "tslm_co2_nino_lag", "tslm_log")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_grid(.model ~ .id) +
theme_minimal()
labels <- c(
"tslm_enso_smooth_lag" = "ENSO and lagged CO2",
"tslm_co2_nino_lag" = "El Nino and lagged CO2",
"tslm_log" = "Basic Log Transformation"
)
caption <- "Comparison of 5yr forecasts for TSLM models with and without predictors.  The basic log transformation model should in ____ only includes a trend and season parameter"
tslm_fc |>
bind_rows(tslm_second_fc) |>
bind_rows(tslm_best_fc) |>
filter(.id == 5, .model %in% c("tslm_enso_smooth_lag", "tslm_co2_nino_lag", "tslm_log")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2018), actual_temp) +
labs(title = "TSLM with and without predictors",
y = 'Temperature', x = "",
caption = str_wrap(caption, width = 80),
colour = "Model",
fill = "Model") +
scale_colour_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
scale_fill_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
facet_wrap(~ .model, ncol = 1, labeller = labeller(.model = labels)) +
theme_minimal() +
theme(plot.caption = element_text(hjust = 0.5))
labels <- c(
"tslm_enso_smooth_lag" = "ENSO and lagged CO2",
"tslm_co2_nino_lag" = "Volcanic Activity, ENSO, and lagged CO2",
"tslm_log" = "Basic Log Transformation"
)
tslm_fc |>
bind_rows(tslm_second_fc) |>
bind_rows(tslm_best_fc) |>
filter(.id == 5, .model %in% c("tslm_enso_smooth_lag", "tslm_volcanic", "tslm_log")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2018), actual_temp) +
labs(title = "TSLM with and without predictors",
y = 'Temperature', x = "",
caption = str_wrap(caption, width = 80),
colour = "Model",
fill = "Model") +
scale_colour_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
scale_fill_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
facet_wrap(~ .model, ncol = 1, labeller = labeller(.model = labels)) +
theme_minimal() +
theme(plot.caption = element_text(hjust = 0.5))
caption <- "Comparison of 5yr forecasts for TSLM models with and without predictors.  The basic log transformation model shown in blue only includes a trend and season parameter"
labels <- c(
"tslm_enso_smooth_lag" = "ENSO and lagged CO2",
"tslm_volcanic" = "Volcanic Activity, ENSO, and lagged CO2",
"tslm_log" = "Basic Log Transformation"
)
caption <- "Comparison of 5yr forecasts for TSLM models with and without predictors.  The basic log transformation model shown in blue only includes a trend and season parameter"
tslm_fc |>
bind_rows(tslm_second_fc) |>
bind_rows(tslm_best_fc) |>
filter(.id == 5, .model %in% c("tslm_enso_smooth_lag", "tslm_volcanic", "tslm_log")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2018), actual_temp) +
labs(title = "TSLM with and without predictors",
y = 'Temperature', x = "",
caption = str_wrap(caption, width = 80),
colour = "Model",
fill = "Model") +
scale_colour_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
scale_fill_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
facet_wrap(~ .model, ncol = 1, labeller = labeller(.model = labels)) +
theme_minimal() +
theme(plot.caption = element_text(hjust = 0.5))
caption <- "Comparison of 5yr forecasts for TSLM models with and without predictors.  The basic log transformation model shown in green only includes a trend and season parameter"
tslm_fc |>
bind_rows(tslm_second_fc) |>
bind_rows(tslm_best_fc) |>
filter(.id == 5, .model %in% c("tslm_enso_smooth_lag", "tslm_volcanic", "tslm_log")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2018), actual_temp) +
labs(title = "TSLM with and without predictors",
y = 'Temperature', x = "",
caption = str_wrap(caption, width = 80),
colour = "Model",
fill = "Model") +
scale_colour_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
scale_fill_discrete(
labels = c("arima_physics_robust_decay_enso_3" = "ARIMA", "ets_additive" = "ETS", "tslm_no_trend" = "TSLM")
) +
facet_wrap(~ .model, ncol = 1, labeller = labeller(.model = labels)) +
theme_minimal() +
theme(plot.caption = element_text(hjust = 0.5))
tslm_fc |>
bind_rows(tslm_second_fc) |>
bind_rows(tslm_best_fc) |>
filter(.id == 5, .model %in% c("tslm_enso_smooth_lag", "tslm_volcanic", "tslm_log")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2018), actual_temp) +
labs(title = "TSLM with and without predictors",
y = 'Temperature', x = "",
caption = str_wrap(caption, width = 80),
colour = "Model",
fill = "Model") +
scale_colour_discrete(
labels = c("tslm_enso_smooth_lag" = "ENSO & CO2", "tslm_volcanic" = "Volcanic, ENSO & CO2", "tslm_log" = "No predictors")
) +
scale_fill_discrete(
labels = c("tslm_enso_smooth_lag" = "ENSO & CO2", "tslm_volcanic" = "Volcanic, ENSO & CO2", "tslm_log" = "No predictors")
) +
facet_wrap(~ .model, ncol = 1, labeller = labeller(.model = labels)) +
theme_minimal() +
theme(plot.caption = element_text(hjust = 0.5))
length(colnames(predictor_modeling))
tslm_fit |>
bind_rows(tslm_second_fit) |>
bind_rows(tslm_best_fit)
tslm_fit
tslm_second_fit
tslm_best_fit
tslm_fit |>
bind_rows(tslm_second_fit) |>
bind_rows(tslm_best_fit)
tslm_fc |>
bind_rows(tslm_second_fc) |>
bind_rows(tslm_best_fc) |>
filter(.id %in% c(4, 5), .model %in% c("tslm_no_trend", "tslm_enso_smooth_lag", "tslm_nino_50_lag", "tslm_co2_nino_lag", "tslm_log")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_grid(.model ~ .id) +
theme_minimal()
tslm_fit |>
left_join(tslm_second_fit, by = ".id") |>
left_join(tslm_best_fit, by = ".id")
tslm_fit |>
left_join(tslm_second_fit, by = ".id") |>
left_join(tslm_best_fit, by = ".id") |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AIC), .fns = mean(na.rm = T)) |>
arrange(AIC)
tslm_fit |>
left_join(tslm_second_fit, by = ".id") |>
left_join(tslm_best_fit, by = ".id") |>
filter(.id < 6) |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AIC, .fns = mean)) |>
arrange(AIC)
tslm_second_fit |>
left_join(tslm_best_fit, by = ".id") |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AIC, .fns = mean)) |>
arrange(AIC)
predictor_modeling |>
autoplot(co2_ppm)
renv::snapshot()
Y
