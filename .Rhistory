left_join
?left_join
?bind_cols
arima_cv_fc |>
accuracy(arima_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
arima_cv_fit |>
select(arima_enso_smooth_log)
arima_cv_fit <- arima_trn |>
model(
arima_auto_log = ARIMA(log(actual_temp) ~ co2_ppm + PDQ(D = 1)),
arima_all_log = ARIMA(log(actual_temp) ~ co2_ppm + ch4_ppb + n2o_ppb + TSI + el_nino + la_nina + PDQ(D = 1)),
arima_lag_ten_nino_log = ARIMA(log(actual_temp) ~ co2_lag10 + el_nino + la_nina + PDQ(D = 1)),
arima_enso_log = ARIMA(log(actual_temp) ~ ENSO + PDQ(D = 1)),
arima_enso_smooth_log_lag = ARIMA(log(actual_temp) ~ enso_smooth + co2_lag10 + PDQ(D = 1)),
arima_auto_30 = ARIMA(log(actual_temp) ~ ENSO + co2_lag30 + PDQ(D = 1))
)
arima_cv_fc <- arima_cv_fit |>
forecast(new_data = arima_valid)
arima_cv_fc |>
accuracy(arima_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
arima_report |>
full_join(arima_cv_fit, by = ".id")
arima_report <- arima_report |>
full_join(arima_cv_fit, by = ".id")
arima_cv_fc |>
accuracy(arima_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
arima_cv_fit |>
select(arima_auto_30)
arima_cv_fit |>
select(arima_auto_30) |>
filter(.id == 5) |>
ggtime::gg_tsresiduals(plot_type = 'partial')
arima_cv_fit |>
select(arima_auto_30) |>
filter(.id == 5) |>
ggtime::gg_tsresiduals()
arima_cv_fit |>
augment() |>
filter(.model == "arima_auto_30") |>
features(.innov, ljung_box, lag = 24)
arima_cv_fit |>
select(arima_all_log) |>
filter(.id == 5) |>
ggtime::gg_tsresiduals()
arima_cv_fit |>
augment() |>
filter(.model == "arima_all_log") |>
features(.innov, ljung_box, lag = 24)
arima_cv_fit <- arima_trn |>
model(
arima_all_log_lag = ARIMA(log(actual_temp) ~ co2_lag10 + n2o_lag10 + ch4_lag10 + PDQ(D = 1)),
arima_all_no_lag = ARIMA(actual_temp ~ co2_ppm + ch4_ppb + n2o_ppb + TSI + el_nino + la_nina + PDQ(D = 1)),
arima_lag_30_nino_log = ARIMA(log(actual_temp) ~ co2_lag30 + el_nino + la_nina + PDQ(D = 1)),
arima_enso_log_mas = ARIMA(log(actual_temp) ~ ENSO + co2_ppm + ch4_ppb + PDQ(D = 1)),
arima_enso_smooth_all = ARIMA(log(actual_temp) ~ enso_smooth + co2_ppm + ch4_ppb + n2o_ppb + TSI + PDQ(D = 1)),
arima_auto_50 = ARIMA(log(actual_temp) ~ ENSO + co2_lag50 + PDQ(D = 1))
)
arima_cv_fc <- arima_cv_fit |>
forecast(new_data = arima_valid)
arima_cv_fc |>
accuracy(arima_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
arima_report <- arima_report |>
full_join(arima_cv_fit, by = ".id")
arima_cv_fit |>
tidy() |>
group_by(.model, term) |>
summarize(across(.cols = c(estimate:`p.value`), .fns = mean)) |>
filter(.model == "arima_auto_50")
arima_cv_fit |>
select(arima_auto_50) |>
filter(.id == 5) |>
ggtime::gg_tsresiduals()
arima_cv_fit |>
select(arima_auto_50) |>
filter(.id == 5) |>
ggtime::gg_tsresiduals(plot_type = "partial")
arima_cv_fit |>
augment() |>
filter(.model == "arima_auto_50") |>
features(.innov, ljung_box, lag = 24)
arima_cv_fit |>
select(arima_auto_50)
arima_cv_fit |>
tidy() |>
group_by(.model, term) |>
summarize(across(.cols = c(estimate:`p.value`), .fns = mean)) |>
filter(.model == "arima_enso_smooth_all")
arima_cv_fit |>
select(arima_enso_smooth_all) |>
filter(.id == 5) |>
ggtime::gg_tsresiduals(plot_type = "partial")
arima_cv_fc |>
accuracy(arima_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
arima_cv_fit |>
tidy() |>
group_by(.model, term) |>
summarize(across(.cols = c(estimate:`p.value`), .fns = mean)) |>
filter(.model == "arima_enso_log_mas")
arima_cv_fc |>
accuracy(arima_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
arima_cv_fit |>
select(arima_lag_30_nino_log) |>
filter(.id == 5) |>
ggtime::gg_tsresiduals(plot_type = "partial")
arima_cv_fc |>
accuracy(arima_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
arima_cv_fit |>
tidy() |>
group_by(.model, term) |>
summarize(across(.cols = c(estimate:`p.value`), .fns = mean)) |>
filter(.model == "arima_all_no_lag")
arima_cv_fit |>
select(arima_all_no_lag) |>
filter(.id == 5) |>
ggtime::gg_tsresiduals(plot_type = "partial")
arima_cv_fit |>
select(arima_all_no_lag)
arima_cv_fit |>
tidy() |>
group_by(.model, term) |>
summarize(across(.cols = c(estimate:`p.value`), .fns = mean)) |>
filter(.model == "arima_all_no_lag")
colnames(arima_report)
arima_cv_fit <- arima_trn |>
model(
arima_all_no_lag_custom = ARIMA(actual_temp ~ co2_ppm + ch4_ppb + n2o_ppb + TSI + el_nino + la_nina + pdq(1, 0, 0) + PDQ(1, 1, 0)),
arima_lag_30_nino_log = ARIMA(log(actual_temp) ~ co2_lag30 + el_nino + la_nina + PDQ(D = 1)),
arima_enso_mas = ARIMA(actual_temp ~ ENSO + co2_ppm + ch4_ppb + PDQ(D = 1)),
arima_enso_smooth_some = ARIMA(actual_temp ~ enso_smooth + co2_ppm + n2o_ppb + PDQ(D = 1)),
arima_auto_50 = ARIMA(log(actual_temp) ~ enso_smooth + co2_lag50 + PDQ(D = 1))
)
arima_cv_fc <- arima_cv_fit |>
forecast(new_data = arima_valid)
arima_cv_fc |>
accuracy(arima_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
arima_cv_fit |>
select(arima_enso_smooth_some) |>
report()
arima_cv_fit |>
tidy() |>
group_by(.model, term) |>
summarize(across(.cols = c(estimate:`p.value`), .fns = mean)) |>
filter(.model == "arima_enso_smooth_some")
arima_cv_fit |>
select(arima_enso_smooth_some) |>
filter(.id == 5) |>
ggtime::gg_tsresiduals(plot_type = "partial")
arima_cv_fit |>
select(arima_enso_smooth_some)
arima_cv_fc |>
accuracy(arima_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
arima_report <- arima_report |>
full_join(arima_cv_fit, by = ".id")
arima_cv_fit |>
select(arima_auto_50) |>
filter(.id == 5) |>
ggtime::gg_tsresiduals(plot_type = "partial")
arima_cv_fit |>
augment() |>
filter(.model == "arima_auto_50") |>
features(.innov, ljung_box, lag = 24)
arima_cv_fc |>
accuracy(arima_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
arima_cv_fit |>
select(arima_enso_smooth_some)
arima_cv_fit <- arima_trn |>
model(
arima_auto_co2 = ARIMA(actual_temp ~ co2_ppm + PDQ(D = 1)),
arima_box_auto = ARIMA(box_cox(actual_temp, lambda = 1.5) ~ co2_ppm + PDQ(D = 1)),
arima_all_no_log = ARIMA(actual_temp ~ co2_ppm + ch4_ppb + n2o_ppb + TSI + el_nino + la_nina + PDQ(D = 1)),
arima_lag_ten_nino_no_log = ARIMA(actual_temp ~ co2_lag10 + el_nino + la_nina + PDQ(D = 1)),
arima_lag_50_nino_no_long = ARIMA(actual_temp ~ co2_lag50 + el_nino + la_nina + PDQ(D = 1))
)
arima_cv_fc <- arima_cv_fit |>
forecast(new_data = arima_valid)
arima_cv_fc |>
accuracy(arima_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
arima_report <- arima_report |>
full_join(arima_cv_fit, by = ".id")
write_rds(arima_report, "data/arima_models.rds")
?slider::slide2_dbl
library(fpp3)
library(tidyverse)
library(knitr)
library(gt)
library(urca)
predictor_modeling <- read_rds("data/lagged_external_predictors.rds")
predictor_modeling |>
filter(year(Date) > 1980) |> dim()
cv_data <- predictor_modeling |>
filter(year(Date) > 1980) |>
stretch_tsibble(.init = 297, .step = 60)
cv_trn <- cv_data |>
group_by(.id) |>
slice(1:(n() - 60)) |>
ungroup()
cv_valid <- cv_data |>
group_by(.id) |>
slice_tail(n = 60) |>
ungroup()
af <- cv_trn |>
model(
arima_physics_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + enso_smooth_3 + PDQ(D=1)),
arima_physics_robust_enso_6 = ARIMA(log(actual_temp) ~ rf_co2 + volcano_forcing + enso_smooth_6 + PDQ(D=1)),
arima_auto_10 = ARIMA(log(actual_temp) ~ ENSO + co2_lag10 + PDQ(D = 1)),
arima_emissions_enso_3 = ARIMA(log(actual_temp) ~ enso_smooth_3 + aggregate_emissions + PDQ(D = 1)),
arima_co2_10_volcano = ARIMA(log(actual_temp) ~ co2_lag10 + volcano_linear + PDQ(D = 1)),
arima_all = ARIMA(log(actual_temp) ~ co2_ppm + ch4_ppb + n2o_ppb + TSI + el_nino + la_nina + volcano_linear + PDQ(D=1)),
arima_lag_30_enso = ARIMA(log(actual_temp) ~ co2_lag30 + ENSO + PDQ(D=1))
)
af_fc <- af |>
forecast(new_data = cv_valid)
af_fc |>
accuracy(cv_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
af |>
glance() |>
select(.model, AICc, AIC, BIC) |>
group_by(.model) |>
summarize(across(.cols = c(AICc, AIC, BIC), .fns = mean)) |>
arrange(AICc)
af |>
select(arima_lag_30_enso) |>
tail(n = 1) |>
ggtime::gg_tsresiduals(plot_type = "partial")
# parameter check
af |>
tidy() |>
group_by(.model, term) |>
summarize(across(.cols = c(estimate:`p.value`), .fns = mean)) |>
filter(.model == "arima_lag_30_enso") |>
kable(digits = 4)
af |>
select(arima_physics_robust_enso_6) |>
tail(n = 1) |>
ggtime::gg_tsresiduals(plot_type = "partial")
# parameter check
af |>
tidy() |>
group_by(.model, term) |>
summarize(across(.cols = c(estimate:`p.value`), .fns = mean)) |>
filter(.model == "arima_physics_robust_enso_6") |>
kable(digits = 4)
af |>
select(arima_physics_enso_3) |>
tail(n = 1) |>
ggtime::gg_tsresiduals(plot_type = "partial")
# parameter check
af |>
tidy() |>
group_by(.model, term) |>
summarize(across(.cols = c(estimate:`p.value`), .fns = mean)) |>
filter(.model == "arima_physics_enso_3") |>
kable(digits = 4)
final_trn <- predictor_modeling |>
filter(year(Date) > 1957) |>
slice(1:(n() - 60))
final_valid <- predictor_modeling |>
filter(year(Date) > 1957) |>
slice_tail(n = 60)
final_fit <- final_trn |>
model(
ets_auto = ETS(),
ets_additive = ETS(actual_temp ~ error("A") + trend("A") + season("A")),
ets_box_auto = ETS(box_cox(actual_temp, lambda = 1.5)),
tslm_no_trend = TSLM(box_cox(actual_temp, lambda = 1.5) ~ season() + enso_smooth_12 + co2_lag50),
tslm_volcanic = TSLM(box_cox(actual_temp, lambda = 1.5) ~ season() + enso_smooth_12 + co2_lag50 + volcano_forcing),
tslm_enso_smooth_lag = TSLM(box_cox(actual_temp, lambda = 1.5) ~ trend() + season() + enso_smooth_6 + co2_lag50),
arima_auto_50 = ARIMA(log(actual_temp) ~ ENSO + co2_lag50 + PDQ(D = 1)),
arima_physics_robust_decay_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + volcano_forcing + enso_smooth_3 + PDQ(D = 1)),
arima_physics_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + enso_smooth_3 + PDQ(D = 1)),
arima_enso_log_co2 = ARIMA(log(actual_temp) ~ ENSO + co2_ppm + PDQ(D = 1)),
arima_physics_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + enso_smooth_3 + PDQ(D = 1))
)
final_trn <- predictor_modeling |>
filter(year(Date) > 1957) |>
slice(1:(n() - 60))
final_valid <- predictor_modeling |>
filter(year(Date) > 1957) |>
slice_tail(n = 60)
final_fit <- final_trn |>
model(
ets_auto = ETS(actual_temp),
ets_additive = ETS(actual_temp ~ error("A") + trend("A") + season("A")),
ets_box_auto = ETS(box_cox(actual_temp, lambda = 1.5)),
tslm_no_trend = TSLM(box_cox(actual_temp, lambda = 1.5) ~ season() + enso_smooth_12 + co2_lag50),
tslm_volcanic = TSLM(box_cox(actual_temp, lambda = 1.5) ~ season() + enso_smooth_12 + co2_lag50 + volcano_forcing),
tslm_enso_smooth_lag = TSLM(box_cox(actual_temp, lambda = 1.5) ~ trend() + season() + enso_smooth_6 + co2_lag50),
arima_auto_50 = ARIMA(log(actual_temp) ~ ENSO + co2_lag50 + PDQ(D = 1)),
arima_physics_robust_decay_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + volcano_forcing + enso_smooth_3 + PDQ(D = 1)),
arima_physics_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + enso_smooth_3 + PDQ(D = 1)),
arima_enso_log_co2 = ARIMA(log(actual_temp) ~ ENSO + co2_ppm + PDQ(D = 1)),
arima_physics_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + enso_smooth_3 + PDQ(D = 1))
)
final_fc <- final_fit |>
forecast(new_data = final_valid)
final_fc |>
accuracy(final_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
final_trn <- predictor_modeling |>
filter(year(Date) > 1957) |>
slice(1:(n() - 60))
final_valid <- predictor_modeling |>
filter(year(Date) > 1957) |>
slice_tail(n = 60)
final_fit <- cv_trn |>
model(
ets_auto = ETS(actual_temp),
ets_additive = ETS(actual_temp ~ error("A") + trend("A") + season("A")),
ets_box_auto = ETS(box_cox(actual_temp, lambda = 1.5)),
tslm_no_trend = TSLM(box_cox(actual_temp, lambda = 1.5) ~ season() + enso_smooth_12 + co2_lag50),
tslm_volcanic = TSLM(box_cox(actual_temp, lambda = 1.5) ~ season() + enso_smooth_12 + co2_lag50 + volcano_forcing),
tslm_enso_smooth_lag = TSLM(box_cox(actual_temp, lambda = 1.5) ~ trend() + season() + enso_smooth_6 + co2_lag50),
arima_auto_50 = ARIMA(log(actual_temp) ~ ENSO + co2_lag50 + PDQ(D = 1)),
arima_physics_robust_decay_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + volcano_forcing + enso_smooth_3 + PDQ(D = 1)),
arima_physics_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + enso_smooth_3 + PDQ(D = 1)),
arima_enso_log_co2 = ARIMA(log(actual_temp) ~ ENSO + co2_ppm + PDQ(D = 1)),
arima_physics_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + enso_smooth_3 + PDQ(D = 1))
)
final_fc <- final_fit |>
forecast(new_data = cv_valid)
final_fc |>
accuracy(cv_valid) |>
select(.model, ME:MAPE) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
final_fc |>
accuracy(cv_valid)
final_fc |>
accuracy(cv_valid) |>
print(n= 50)
final_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarize(across(.cols = c(ME:MAPE), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
# parameter check
final_fit |>
tidy() |>
group_by(.model, term) |>
summarize(across(.cols = c(estimate:`p.value`), .fns = mean)) |>
filter(.model == "arima_physics_enso_3") |>
kable(digits = 4)
final_fit |>
glance() |>
select(.model, AICc, AIC, BIC) |>
group_by(.model) |>
summarize(across(.cols = c(AICc, AIC, BIC), .fns = mean)) |>
arrange(AICc)
final_fit |>
select(arima_physics_enso_3) |>
tail(n = 1) |>
ggtime::gg_tsresiduals(plot_type = "partial")
final_fit |>
select(tslm_no_trend) |>
tail(n = 1) |>
ggtime::gg_tsresiduals(plot_type = "partial")
final_fit |>
select(tslm_no_trend) |>
tail(n = 1) |>
augment() |>
features(.innov, ljung_box, lag = 24)
final_fit |>
select(tslm_no_trend) |>
augment() |>
features(.innov, ljung_box, lag = 24)
final_fit |>
select(arima_physics_enso_3              ) |>
augment() |>
features(.innov, ljung_box, lag = 24)
final_fit |>
select(tslm_no_trend) |>
tail(n = 1) |>
report()
final_fit |>
select(tslm_volcanic) |>
tail(n = 1) |>
report()
final_fit |>
select(arima_auto_50) |>
tail(n = 1) |>
report()
final_fit |>
select(arima_auto_50) |>
tail(n = 1) |>
tidy()
final_fit |>
select(tslm_volcanic) |>
tail(n = 1) |>
tidy()
final_fit |>
select(tslm_volcanic) |>
tail(n = 1) |>
report()
inv_box_cox(0.043319, lambda = 1.5)
inv_box_cox(14.3, lambda = 1.5)
final_fc
final_fc |>
filter(.model == tslm_no_trend)
final_fc |>
filter(.model == "tslm_no_trend")
final_fc |>
filter(.id %in% c(5, 6), .model %in% c("tslm_no_trend", "arima_enso_log_co2", "ets_additive", "arima_physics_robust")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_wrap(~ .model, ncol = 1) +
theme_minimal()
final_fc |>
filter(.id %in% c(5, 6), .model %in% c("tslm_no_trend", "arima_enso_log_co2", "ets_additive")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_wrap(~ .model, ncol = 1) +
theme_minimal()
final_fc |>
filter(.id %in% c(4, 5), .model %in% c("tslm_no_trend", "arima_enso_log_co2", "ets_additive")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_wrap(~ .model, ncol = 1) +
theme_minimal()
final_fc |>
filter(.id %in% c(4, 5), .model %in% c("tslm_no_trend", "arima_physics_enso_3", "ets_additive")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_wrap(~ .model, ncol = 1) +
theme_minimal()
final_fc |>
filter(.id %in% c(4, 5), .model %in% c("tslm_volcanic", "arima_physics_enso_3", "ets_additive")) |>
autoplot() +
autolayer(predictor_modeling |> filter(year(Date) >= 2015), actual_temp) +
facet_wrap(~ .model, ncol = 1) +
theme_minimal()
full_fit <- predictor_modeling |>
model(
tslm_no_trend = TSLM(box_cox(actual_temp, lambda = 1.5) ~ season() + enso_smooth_12 + co2_lag50),
arima_auto_50 = ARIMA(log(actual_temp) ~ ENSO + co2_lag50 + PDQ(D = 1)),
arima_physics_robust_decay_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + volcano_forcing + enso_smooth_3 + PDQ(D = 1)),
arima_physics_enso_3 = ARIMA(log(actual_temp) ~ rf_co2 + enso_smooth_3 + PDQ(D = 1)),
arima_enso_log_co2 = ARIMA(log(actual_temp) ~ ENSO + co2_ppm + PDQ(D = 1)),
)
full_fc <- full_fit |>
forecast(h = 20)
predictor_modeling |>
model(STL(ENSO)) |>
components() |>
autoplot()
?simulate
