converted_df |>
feat_stl(actual_temp)
converted_df |>
features(actual_temp, feat_stl)
converted_df |>
features(actual_temp, feat_spectral)
converted_df |>
features(actual_temp, coef_hurst)
coef_hurst(converted_df)
install.packages('fracdiff')
converted_df |>
features(actual_temp, coef_hurst)
converted_df |>
features(actual_temp, var_tiled_mean)
converted_df |>
features(actual_temp, shift_level_max)
converted_df |>
features(actual_temp, longest_flat_spot)
?longest_flat_spot
fc_ets |>
accuracy(test)
#| label: ets-forecast-zoom
#| echo: true
#| fig-cap: "Auto-ETS forecast vs actuals (2020–2025)."
fc_ets <- fit_ets |>
forecast(new_data = test)
fc_ets_zoom <- fc_ets|>
filter_index("2020 Jan" ~ "2025 Dec")
autoplot(
fc_ets_zoom,
Anomaly_data|> filter_index("2020 Jan" ~ "2025 Dec")
) +
labs(
title = "Auto-ETS Forecast vs Actuals (2020–2025)",
subtitle = "Automatically selected ETS model",
x = "Year",
y = "Temperature Monthly_Anomaly (°C)"
) |>
theme_minimal()
#| label: ets-forecast-zoom
#| echo: true
#| fig-cap: "Auto-ETS forecast vs actuals (2020–2025)."
fc_ets <- fit_ets |>
forecast(new_data = test)
fc_ets_zoom <- fc_ets|>
filter_index("2020 Jan" ~ "2025 Dec")
autoplot(
fc_ets_zoom,
Anomaly_data|> filter_index("2020 Jan" ~ "2025 Dec")
) +
labs(
title = "Auto-ETS Forecast vs Actuals (2020–2025)",
subtitle = "Automatically selected ETS model",
x = "Year",
y = "Temperature Monthly_Anomaly (°C)"
) |>
theme_minimal()
#| label: ets-forecast-zoom
#| echo: true
#| fig-cap: "Auto-ETS forecast vs actuals (2020–2025)."
fc_ets <- fit_ets |>
forecast(new_data = test)
fc_ets_zoom <- fc_ets|>
filter_index("2020 Jan" ~ "2025 Dec")
autoplot(
fc_ets_zoom,
Anomaly_data |> filter_index("2020 Jan" ~ "2025 Dec")
) +
labs(
title = "Auto-ETS Forecast vs Actuals (2020–2025)",
subtitle = "Automatically selected ETS model",
x = "Year",
y = "Temperature Monthly_Anomaly (°C)"
) |>
theme_minimal()
#| label: ets-forecast-zoom
#| echo: true
#| fig-cap: "Auto-ETS forecast vs actuals (2020–2025)."
fc_ets <- fit_ets |>
forecast(new_data = test)
fc_ets_zoom <- fc_ets|>
filter_index("2020 Jan" ~ "2025 Dec")
autoplot(
fc_ets_zoom,
Anomaly_data |> filter_index("2020 Jan" ~ "2025 Dec")
) +
labs(
title = "Auto-ETS Forecast vs Actuals (2020–2025)",
subtitle = "Automatically selected ETS model",
x = "Year",
y = "Temperature Monthly_Anomaly (°C)"
)
library(gt)
ets_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
gt(decimals = 4)
ets_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
gt(decimal = 4)
ets_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
gt()
?gt
ets_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
gt() |>
fmt_number(decimals = 4)
# Report on top performing model
ets_fit |>
filter(.id == 10) |>
select(log_auto) |>
report()
#| message: false
#| warning: false
ets_fit |>
accuracy() |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4, align = "c")
# Smoothing parameters
ets_fit |>
tidy() |>
group_by(.model, term) |>
summarise(across(.cols = estimate, .fns = mean)) |>
pivot_wider(names_from = term, values_from = estimate) |>
select(.model, alpha, beta, gamma, phi) |>
kable(digits = 4, align = "c")
# Report on top performing model
ets_fit |>
filter(.id == 10) |>
select(log_auto) |>
report()
#| fig-width: 10
ets_fc |>
filter(.id %in% c(10, 11), .model %in% c('additive', 'ets_auto', "multiplicative")) |>
autoplot() +
autolayer(converted_df |> filter(year(Date) > 2010), actual_temp) +
facet_grid(.model ~ .id) +
theme_minimal()
ets_fc |>
filter(.id %in% c(10, 11), .model %in% c('additive', 'ets_auto', "multiplicative")) |>
autoplot() +
autolayer(converted_df |> filter(year(Date) > 2010), actual_temp) +
facet_grid(.model ~ .id) +
labs(title = "Forecast Performance of ETS Models") +
theme_minimal()
ets_fc |>
filter(.id %in% c(10, 11), .model %in% c('additive', 'ets_auto', "multiplicative")) |>
autoplot() +
autolayer(converted_df |> filter(year(Date) > 2010), actual_temp) +
facet_grid(.model ~ .id) +
labs(title = "Forecast Performance of ETS Models", y = "Temperature") +
theme_minimal()
?facet_grid
# Define a named vector to map model names to desired display names
model_labels <- c(
'additive' = 'Additive',
'ets_auto' = 'Auto Selection',
'multiplicative' = 'Multiplicative'
)
ets_fc |>
filter(.id %in% c(10, 11), .model %in% c('additive', 'ets_auto', "multiplicative")) |>
autoplot() +
autolayer(converted_df |> filter(year(Date) > 2010), actual_temp) +
facet_grid(
.model ~ .id,
labeller = labeller(.model = model_labels) # <--- The key change is here
) +
labs(title = "Forecast Performance of ETS Models", y = "Temperature") +
theme_minimal()
ets_fc |>
filter(.id %in% c(10, 11), .model %in% c('additive', 'ets_auto', "multiplicative")) |>
autoplot() +
autolayer(converted_df |> filter(year(Date) > 2015), actual_temp) +
facet_grid(
.model ~ .id,
labeller = labeller(.model = model_labels) # <--- The key change is here
) +
labs(title = "Forecast Performance of ETS Models", y = "Temperature") +
theme_minimal()
ets_fit |>
select(box_cox_auto) |>
tail(n = 1) |>
ggtime::gg_tsresiduals()
ets_fit |>
select(box_cox_auto) |>
tail(n = 1) |>
ggtime::gg_tsresiduals()
ets_fit |>
select(box_cox_auto) |>
filter(.id == 6) |>
ggtime::gg_tsresiduals()
ets_fit |>
select(box_cox_auto) |>
tail(n = 1) |>
ggtime::gg_tsresiduals()
ets_fit |>
augment() |>
filter(.model == "box_cox_auto") |>
features(.innov, ljung_box, lag = 24) |>
summarize(across(.cols = lb_pvalue, .fns = mean)) |>
kable(digits = 4, align = "c")
ets_fit |>
augment() |>
filter(.model == "additive") |>
features(.innov, ljung_box, lag = 24) |>
summarize(across(.cols = lb_pvalue, .fns = mean)) |>
kable(digits = 4, align = "c")
ets_fit |>
augment() |>
filter(.model == "log_auto") |>
features(.innov, ljung_box, lag = 24) |>
summarize(across(.cols = lb_pvalue, .fns = mean)) |>
kable(digits = 4, align = "c")
ets_fit |>
augment() |>
filter(.model == "damped") |>
features(.innov, ljung_box, lag = 24) |>
summarize(across(.cols = lb_pvalue, .fns = mean)) |>
kable(digits = 4, align = "c")
ets_fit |>
augment() |>
filter(.model == "additive") |>
features(.innov, ljung_box, lag = 24) |>
summarize(across(.cols = lb_pvalue, .fns = mean)) |>
kable(digits = 4, align = "c")
ets_fit |>
augment() |>
filter(.model == "box_cox_auto") |>
features(.innov, ljung_box, lag = 24) |>
summarize(across(.cols = lb_pvalue, .fns = mean)) |>
kable(digits = 4, align = "c")
ets_fit |>
augment() |>
features(.innov, ljung_box, lag = 24) |>
summarize(across(.cols = lb_pvalue, .fns = mean)) |>
kable(digits = 4, align = "c")
ets_fit |>
augment() |>
features(.innov, ljung_box, lag = 24) |>
group_by(.model) |>
summarize(across(.cols = lb_pvalue, .fns = mean)) |>
kable(digits = 4, align = "c")
ets_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AICc, .fns = mean)) |>
kable(digits = 4, align = "c")
predictor_modeling <- read_rds("data/lagged_external_predictors.rds")
glance(predictor_modeling)
colnames(predictor_modeling)
length(colnames(predictor_modeling))
tslm_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(ME) |>
kable(digits = 4)
tslm_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(MAE) |>
kable(digits = 4)
ets_fit |>
augment() |>
group_by(.model) |>
features(.innov, ljung_box, lag = 24) |>
summarize(across(.cols = lb_pvalue, .fns = mean))
ets_fit |>
augment() |>
features(.innov, ljung_box, lag = 24) |>
group_by(.model) |>
summarize(across(.cols = lb_pvalue, .fns = mean))
tslm_fit |>
augment() |>
features(.innov, ljung_box, lag = 24) |>
group_by(.model) |>
summarize(across(.cols = lb_pvalue, .fns = mean))
tslm_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AIcc, .fns = mean))
tslm_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AICc, .fns = mean))
#| message: false
#| warning: false
cv_data <- predictor_modeling |>
filter(year(Date) > 1957) |>
stretch_tsibble(.init = 573, .step = 60)
cv_trn <- cv_data |>
group_by(.id) |>
slice(1:(n() - 60)) |>
ungroup()
cv_valid <- cv_data |>
group_by(.id) |>
slice_tail(n = 60) |>
ungroup()
tslm_regressor_fit <- cv_trn |>
model(
tslm_trend_season = TSLM(actual_temp ~ trend() + season()),
tslm_log = TSLM(log(actual_temp) ~ trend() + season()),
tslm_box_cox = TSLM(box_cox(actual_temp, lambda = 1.5) ~ trend() + season()),
tslm_all = TSLM(actual_temp ~ trend() + season() + el_nino + la_nina + co2_ppm + ch4_ppb + n2o_ppb + TSI + volcano_forcing),
tslm_all_box = TSLM(box_cox(actual_temp, lambda = 1.5) ~ trend() + season() + el_nino + la_nina + co2_ppm + ch4_ppb + n2o_ppb + TSI + volcano_forcing),
tslm_ch4_co2_nino = TSLM(actual_temp ~ trend() + season() + el_nino + la_nina + co2_ppm + ch4_ppb),
tslm_co2_nino = TSLM(actual_temp ~ trend() + season() + el_nino + la_nina + co2_ppm),
tslm_nino = TSLM(actual_temp ~ trend() + season() + el_nino + la_nina),
tslm_enso = TSLM(actual_temp ~ trend() + season() + ENSO),
tslm_enso_smooth = TSLM(actual_temp ~ trend() + season() + enso_smooth_12),
tslm_co2_nino_lag = TSLM(actual_temp ~ trend() + season() + el_nino + la_nina + co2_lag1)
)
tslm_regressor_fit |>
accuracy() |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
tslm_regressor_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = c(AIC, AICc, BIC), .fns = mean)) |>
arrange(AICc)
tslm_fc <- tslm_regressor_fit |>
forecast(new_data = cv_valid)
tslm_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
tslm_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(ME) |>
kable(digits = 4)
tslm_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(MAE) |>
kable(digits = 4)
tslm_regressor_fit |>
glance() |>
features(.innov, ljung_box, lag = 24) |>
group_by(.model) |>
summarize(across(.cols = lb_pvalue, .fns = mean))
tslm_regressor_fit |>
augment() |>
features(.innov, ljung_box, lag = 24) |>
group_by(.model) |>
summarize(across(.cols = lb_pvalue, .fns = mean))
tslm_second_fit <- cv_trn |>
model(
tslm_all_lag_box = TSLM(box_cox(actual_temp, lambda = 1.5) ~ trend() + season() + el_nino + la_nina + co2_lag1 + n2o_lag3 + ch4_lag3),
tslm_nino_five_lag = TSLM(actual_temp ~ trend() + season() + el_nino + la_nina + co2_lag5),
tslm_enso_co2_lag = TSLM(actual_temp ~ trend() + season() + ENSO + co2_lag1),
tslm_enso_smooth_lag_all = TSLM(actual_temp ~ trend() + season() + enso_smooth_12 + co2_lag1 + n2o_lag3 + ch4_lag3),
tslm_all_lag = TSLM(actual_temp ~ trend() + season() + el_nino + la_nina + co2_lag1 + n2o_lag3 + ch4_lag3),
tslm_nino_10_lag = TSLM(box_cox(actual_temp, lambda = 1.5) ~ trend() + season() + el_nino + la_nina + co2_lag10),
tslm_enso_smooth_lag = TSLM(box_cox(actual_temp, lambda = 1.5) ~ trend() + season() + enso_smooth_6 + co2_lag10)
)
tslm_second_fc <- tslm_second_fit |>
forecast(new_data = cv_valid)
tslm_second_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
tslm_second_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(ME) |>
kable(digits = 4)
tslm_second_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(MAE) |>
kable(digits = 4)
tslm_regressor_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AICc, .fns = mean))
tslm_regressor_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AICc, .fns = mean)) |>
arrange(AICc)
tslm_second_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AICc, .fns = mean)) |>
arrange(AICc)
tslm_best_fit <- cv_trn |>
model(
tslm_enso_6 = TSLM(box_cox(actual_temp, lambda = 1.5) ~ trend() + season() + enso_smooth_6 + co2_lag10),
tslm_enso_12 = TSLM(box_cox(actual_temp, lambda = 1.5) ~ trend() + season() + enso_smooth_12 + co2_lag10),
tslm_no_trend = TSLM(box_cox(actual_temp, lambda = 1.5) ~ season() + enso_smooth_12 + co2_lag10),
tslm_volcanic = TSLM(box_cox(actual_temp, lambda = 1.5) ~ season() + enso_smooth_12 + co2_lag10 + volcano_forcing)
)
tslm_best_fc <- tslm_best_fit |>
forecast(new_data = cv_valid)
tslm_best_fc |>
accuracy(cv_valid) |>
group_by(.model) |>
summarise(across(.cols = c(RMSE, MAE, ME), .fns = mean)) |>
arrange(RMSE) |>
kable(digits = 4)
tslm_best_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AICc, .fns = mean)) |>
arrange(AICc)
tslm_second_fit |>
augment() |>
features(.innov, ljung_box, lag = 24) |>
group_by(.model) |>
summarize(across(.cols = lb_pvalue, .fns = mean))
tslm_best_fit |>
augment() |>
features(.innov, ljung_box, lag = 24) |>
group_by(.model) |>
summarize(across(.cols = lb_pvalue, .fns = mean))
tslm_regressor_fit |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AICc, .fns = mean)) |>
arrange(AICc)
?accuracy
?accuracy.,mdl_ts
?accuracy.mdl_ts
?ME
?ME
tslm_best_fc |>
glance() |>
group_by(.model) |>
summarize(across(.cols = AICc, .fns = mean)) |>
arrange(AICc)
tslm_best_fc |>
augment() |>
features(.innov, ljung_box, lag = 24) |>
group_by(.model) |>
summarize(across(.cols = lb_pvalue, .fns = mean))
tslm_best_fc
tslm_best_fc |>
augment(cv_valid)
tslm_best_fc |>
accuracy(cv_valid)
tslm_regressor_fit |>
augment()
tslm_regressor_fit |>
augment() |>
filter(.model = "tslm_log")
tslm_regressor_fit |>
augment() |>
filter(.model == "tslm_log")
?glance
tslm_best_fit
tslm_best_fit |>
glance()
tslm_regressor_fit |>
augment() |>
filter(.model == "tslm_all_box")
tslm_best_fit |>
glance()
tslm_best_fit |>
filter(.model == 'tslm_log') |>
glance()
tslm_regressor_fit |>
filter(.model == 'tslm_log') |>
glance()
tslm_regressor_fit
tslm_regressor_fit |>
select(tslm_log) |>
glance()
tslm_regressor_fit |>
augment() |>
filter(.model == "tslm_all_box")
tslm_regressor_fit |>
augment() |>
filter(.model == "tslm_log")
tslm_regressor_fit |>
select(tslm_log) |>
glance() |>
select()
tslm_regressor_fit |>
select(tslm_log) |>
glance() |>
select(df.residual())
tslm_regressor_fit |>
select(tslm_log) |>
glance() |>
select(df.residual)
